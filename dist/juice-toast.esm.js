/**
 * 2026 (C) OpenDN Foundation
 * v120/2026 Juice Toast
 * ESM (ECMAScript Module (import/export))
 */
let isBrowser="undefined"!=typeof window&&"undefined"!=typeof document,themes={light:{bg:"#ffffff",color:"#111",border:"1px solid #e5e7eb"},dark:{bg:"#1f2937",color:"#fff",border:"1px solid rgba(255,255,255,.08)"}},sizePreset={sm:{width:"260px",padding:"10px"},md:{width:"320px",padding:"14px"},lg:{width:"420px",padding:"18px"}},juiceToast={_config:{},_queue:[],_showing:!1,_theme:"dark",setup(e={}){this._config=e,this._defaults={...this._defaults,...e},this._registerTypes()},addType(e,t={}){this._config[e]=t,this._registerTypes()},defineTheme(e,t={}){themes[e]={...themes[e]||{},...t}},setTheme(e){if(this._theme=e,!isBrowser)return;let t=document.getElementById("juice-toast-root");t&&(t.dataset.theme=e)},clear(){this._queue.length=0},destroy(){this.clear(),isBrowser&&document.getElementById("juice-toast-root")?.remove()},_registerTypes(){Object.keys(this._config).forEach(e=>{if("function"==typeof this[e]&&!this[e].__auto)return;let t=t=>this._enqueue(e,t);t.__auto=!0,this[e]=t})},_enqueue(e,t){this._queue.push({type:e,payload:t}),this._showing||this._next()},_next(){if(!this._queue.length){this._showing=!1;return}this._showing=!0;let e=this._queue.shift();this._showToast(e.type,e.payload)},_normalizeGlass(e){if(!0===e)return 60;if(!1===e||null==e)return 0;let t=Number(e);return Number.isFinite(t)?Math.max(0,Math.min(100,t)):0},_getRoot(e){if(!isBrowser)return null;let t=document.getElementById("juice-toast-root");return t||((t=document.createElement("div")).id="juice-toast-root",document.body.appendChild(t)),t.dataset.position=e||"bottom",t.dataset.theme=this._theme,t},_defaults:{duration:2500,maxVisible:3,swipeThreshold:60,glassUI:0,playSound:null},_playSound(e){if(!isBrowser)return;let t="string"==typeof e&&e?e:this._defaults.playSound;if(t)try{let i=new Audio(t);i.volume=.6,i.play().catch(()=>{})}catch{}},_showToast(e,t){if(!isBrowser)return;let i=this._config[e]||{},s="object"==typeof t?t:{message:String(t)},o={...i,...s};o.icon=o.icon??o.icon_left_top,o.iconPack=o.iconPack??o.icon_config,o.iconLink=o.iconLink??o.icon_onClick_url,o.iconAnimate=o.iconAnimate??o.icon_onClick_animate,o.position=o.position??o.toast,o.closable=o.closable??o.closeable,o.iconPosition=o.iconPosition||"left",o.compact=!!o.compact;let n=themes[o.theme||this._theme]||{},a=document.createElement("div");if(a.className="juice-toast",o.size&&sizePreset[o.size]){let l=sizePreset[o.size];l.width&&(a.style.width=l.width),l.padding&&(a.style.padding=l.padding)}let d=this._normalizeGlass(o.glassUI??this._defaults.glassUI);d>0&&(a.classList.add("jt-glass"),a.style.setProperty("--jt-glass",d)),d||(a.style.background=o.bg||n.bg),a.style.color=o.color||n.color,a.style.border=o.border||n.border,o.compact&&a.classList.add("jt-compact"),(o.glassUI??this._defaults.glassUI)&&a.classList.add("jt-glass"),o.width&&(a.style.width=o.width),o.height&&(a.style.height=o.height);let c=null;o.icon&&((c=document.createElement("i")).className=["icon",o.iconPack||"",o.icon].join(" ").trim(),o.iconSize&&(c.style.fontSize=o.iconSize),(o.iconLink||o.iconAnimate)&&(c.classList.add("icon-clickable"),c.onclick=e=>{e.stopPropagation(),o.iconAnimate&&(c.classList.remove(o.iconAnimate),c.offsetWidth,c.classList.add(o.iconAnimate)),o.iconLink&&window.open(o.iconLink,"_blank","noopener")}));let r=0,h=0;a.addEventListener("touchstart",e=>{r=e.touches[0].clientX}),a.addEventListener("touchmove",e=>{h=e.touches[0].clientX-r,a.style.transform=`translateX(${h}px)`}),a.addEventListener("touchend",()=>{Math.abs(h)>this._defaults.swipeThreshold?(a.style.transform=`translateX(${h>0?1e3:-1e3}px)`,setTimeout(()=>{a.remove(),this._next()},200)):a.style.transform="",r=h=0});let p=document.createElement("div");if(p.className="jt-content",o.title){let u=document.createElement("div");u.className="jt-title",u.textContent=o.title,p.appendChild(u)}let m=document.createElement("div");if(m.className="jt-message",m.textContent=o.message||"",p.appendChild(m),c&&"top"===o.iconPosition?(a.classList.add("jt-icon-top"),a.appendChild(c),a.appendChild(p)):c&&"right"===o.iconPosition?(a.appendChild(p),a.appendChild(c)):(c&&a.appendChild(c),a.appendChild(p)),Array.isArray(o.actions)&&o.actions.length){let f=document.createElement("div");f.className="jt-actions",o.actions.forEach(e=>{let t=document.createElement("button");t.className="jt-action",t.textContent=e.label,t.onclick=t=>{t.stopPropagation(),e.onClick?.(t),e.closeOnClick&&(a.remove(),this._next())},f.appendChild(t)}),p.appendChild(f)}if(o.closable){let g=document.createElement("span");g.className="juice-toast-close",g.innerHTML="\xd7",g.onclick=()=>{a.remove(),this._next()},a.appendChild(g)}let $=this._getRoot(o.position),y=this._defaults.maxVisible;y&&$.children.length>=y&&$.firstChild.remove(),$.appendChild(a),requestAnimationFrame(()=>a.classList.add("show"));let w=o.duration??2500;if(0===w)return;let b=Date.now(),v=o.duration??this._defaults.duration,x,L=()=>{if(a.__paused)b=Date.now();else{let e=Date.now();v-=e-b,b=e}v<=0?(a.classList.remove("show"),setTimeout(()=>{a.remove(),this._next()},300)):x=requestAnimationFrame(L)};a.addEventListener("mouseenter",()=>a.__paused=!0),a.addEventListener("mouseleave",()=>a.__paused=!1),a.addEventListener("touchstart",()=>a.__paused=!0),a.addEventListener("touchend",()=>a.__paused=!1),requestAnimationFrame(L)}};export default juiceToast;export{juiceToast};